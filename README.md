# relational-algebra
for fun

===========================

### Create a people table
```
scala> 

import me.vincentzz.relational.relation.Relation
import me.vincentzz.relational.relation.RBRelation
import me.vincentzz.relational.typedesc._
import me.vincentzz.relational.relation.persist.CSV
import me.vincentzz.relational.relation.Aggregation

import org.joda.time.DateTime

val ppl = RBRelation.create(List( "ID", "NAME", "AGE", "DEPARTMENT", "ON_BOARD_DATE"),
                            List( LONG, STRING,   INT,       STRING,           DATE ),
                            List( "ID"                                              ),
                            List((  1L,  "DGF",    33,        "Dev", DateTime.now()),
                                 (  2L,   "YH",    32,        "Dev", DateTime.now()),
                                 (  3L,  "ZJB",    38,      "Sales", DateTime.now()),
                                 (  4L,  "ZYX",    33,         "BA", DateTime.now()),
                                 (  5L,  "LYP",    33,         "HR", DateTime.now()),
                                 (  6L,  "JWH",    33,      "Sales", DateTime.now())))
```

```
+-------+---------+------+------------+-------------------------------+
|  ID   |  NAME   | AGE  | DEPARTMENT |         ON_BOARD_DATE         |
+-------+---------+------+------------+-------------------------------+
| :Long | :String | :Int |  :String   |             :Date             |
+-------+---------+------+------------+-------------------------------+
|   1   |   DGF   |  33  |    Dev     | 2018-07-27T00:21:31.370+08:00 |
+-------+---------+------+------------+-------------------------------+
|   2   |   YH    |  32  |    Dev     | 2018-07-27T00:21:31.370+08:00 |
+-------+---------+------+------------+-------------------------------+
|   3   |   ZJB   |  38  |   Sales    | 2018-07-27T00:21:31.370+08:00 |
+-------+---------+------+------------+-------------------------------+
|   4   |   ZYX   |  33  |     BA     | 2018-07-27T00:21:31.370+08:00 |
+-------+---------+------+------------+-------------------------------+
|   5   |   LYP   |  33  |     HR     | 2018-07-27T00:21:31.370+08:00 |
+-------+---------+------+------------+-------------------------------+
|   6   |   JWH   |  33  |   Sales    | 2018-07-27T00:21:31.370+08:00 |
+-------+---------+------+------------+-------------------------------+
```

### Save to readable/modifiable CSV file
```
scala> CSV.saveToCSV("/home/vincent/Desktop/people.csv", ppl)
```

### Load from CSV
```
scala> 

CSV.loadFromCSV("/home/vincent/Desktop/people.csv",
                List("NAME", "ON_BOARD_DATE"     ),
                List(STRING, DATE                ))
```

```
+---------+-------------------------------+
|  NAME   |         ON_BOARD_DATE         |
+---------+-------------------------------+
| :String |             :Date             |
+---------+-------------------------------+
|   DGF   | 2018-07-27T00:23:55.127+08:00 |
+---------+-------------------------------+
|   YH    | 2018-07-27T00:23:55.127+08:00 |
+---------+-------------------------------+
|   ZJB   | 2018-07-27T00:23:55.127+08:00 |
+---------+-------------------------------+
|   ZYX   | 2018-07-27T00:23:55.127+08:00 |
+---------+-------------------------------+
|   LYP   | 2018-07-27T00:23:55.127+08:00 |
+---------+-------------------------------+
|   JWH   | 2018-07-27T00:23:55.127+08:00 |
+---------+-------------------------------+
```

### Keep specified columns
```
scala> ppl.project(List("ID","NAME"))
```

```
+-------+---------+
|  ID   |  NAME   |
+-------+---------+
| :Long | :String |
+-------+---------+
|   1   |   DGF   |
+-------+---------+
|   2   |   YH    |
+-------+---------+
|   3   |   ZJB   |
+-------+---------+
|   4   |   ZYX   |
+-------+---------+
|   5   |   LYP   |
+-------+---------+
|   6   |   JWH   |
+-------+---------+
```

### Drop specified columns
```
scala> ppl.allBut(List("DEPARTMENT","ON_BOARD_DATE")

+-------+---------+------+
|  ID   |  NAME   | AGE  |
+-------+---------+------+
| :Long | :String | :Int |
+-------+---------+------+
|   1   |   DGF   |  33  |
+-------+---------+------+
|   2   |   YH    |  32  |
+-------+---------+------+
|   3   |   ZJB   |  38  |
+-------+---------+------+
|   4   |   ZYX   |  33  |
+-------+---------+------+
|   5   |   LYP   |  33  |
+-------+---------+------+
|   6   |   JWH   |  33  |
+-------+---------+------+
```

### Rename columns
```
scala> ppl.rename(List("DEPARTMENT","ON_BOARD_DATE"), List("DEP", "ON_BOARD"))
```

```
+-------+---------+------+---------+-------------------------------+
|  ID   |  NAME   | AGE  |   DEP   |           ON_BOARD            |
+-------+---------+------+---------+-------------------------------+
| :Long | :String | :Int | :String |             :Date             |
+-------+---------+------+---------+-------------------------------+
|   1   |   DGF   |  33  |   Dev   | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+---------+-------------------------------+
|   2   |   YH    |  32  |   Dev   | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+---------+-------------------------------+
|   3   |   ZJB   |  38  |  Sales  | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+---------+-------------------------------+
|   4   |   ZYX   |  33  |   BA    | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+---------+-------------------------------+
|   5   |   LYP   |  33  |   HR    | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+---------+-------------------------------+
|   6   |   JWH   |  33  |  Sales  | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+---------+-------------------------------+
```

### Fiter record with lambda
```
scala> 

def condition = (id: Long) => (dep: String) => id == 5 || dep == "Dev"
ppl.restrict(condition, List("ID", "DEPARTMENT"))
```

```
+-------+---------+------+------------+-------------------------------+
|  ID   |  NAME   | AGE  | DEPARTMENT |         ON_BOARD_DATE         |
+-------+---------+------+------------+-------------------------------+
| :Long | :String | :Int |  :String   |             :Date             |
+-------+---------+------+------------+-------------------------------+
|   1   |   DGF   |  33  |    Dev     | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+------------+-------------------------------+
|   2   |   YH    |  32  |    Dev     | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+------------+-------------------------------+
|   5   |   LYP   |  33  |     HR     | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+------------+-------------------------------+
|   6   |   JWH   |  33  |   Sales    | 2018-07-27T00:23:55.127+08:00 |
+-------+---------+------+------------+-------------------------------+
```

### Extend table by applying specified columns to lambda
```
scala> 

def nameWithAge = (name: String) => (age: Int) => s"$name-$age"
ppl.extend(nameWithAge, List("NAME", "AGE"), List("NAME_WITH_AGE"))
```

```
+-------+---------+------+------------+-------------------------------+---------------+
|  ID   |  NAME   | AGE  | DEPARTMENT |         ON_BOARD_DATE         | NAME_WITH_AGE |
+-------+---------+------+------------+-------------------------------+---------------+
| :Long | :String | :Int |  :String   |             :Date             |    :String    |
+-------+---------+------+------------+-------------------------------+---------------+
|   1   |   DGF   |  33  |    Dev     | 2018-07-27T00:23:55.127+08:00 |    DGF-33     |
+-------+---------+------+------------+-------------------------------+---------------+
|   2   |   YH    |  32  |    Dev     | 2018-07-27T00:23:55.127+08:00 |     YH-32     |
+-------+---------+------+------------+-------------------------------+---------------+
|   3   |   ZJB   |  38  |   Sales    | 2018-07-27T00:23:55.127+08:00 |    ZJB-38     |
+-------+---------+------+------------+-------------------------------+---------------+
|   4   |   ZYX   |  33  |     BA     | 2018-07-27T00:23:55.127+08:00 |    ZYX-33     |
+-------+---------+------+------------+-------------------------------+---------------+
|   5   |   LYP   |  33  |     HR     | 2018-07-27T00:23:55.127+08:00 |    LYP-33     |
+-------+---------+------+------------+-------------------------------+---------------+
|   6   |   JWH   |  33  |   Sales    | 2018-07-27T00:23:55.127+08:00 |    JWH-33     |
+-------+---------+------+------------+-------------------------------+---------------+
```

### Summarize data grouping by specifed columns
```
scala> ppl.summarize(List("DEPARTMENT"), Aggregation.AVG, "AGE", List("AVG_AGE"))
```

```
+------------+---------+
| DEPARTMENT | AVG_AGE |
+------------+---------+
|  :String   | :Double |
+------------+---------+
|    Dev     |  32.5   |
+------------+---------+
|   Sales    |  35.5   |
+------------+---------+
|     BA     |  33.0   |
+------------+---------+
|     HR     |  33.0   |
+------------+---------+
```

### Table joining
We need a new table for projects first.
```
scala> 
val prj = RBRelation.create(List( "DEPARTMENT",   "PROJECT", "LEAD"),
                            List(       STRING,      STRING, STRING),
                            Nil,
                            List((       "Dev", "manhattan",  "DGF"),
                                 (     "Sales", "sell boom",  "ZJB"),
                                 (     "Sales","accounting",  "JWH"),
                                 (        "HR",   "recruit",  "LYP"),
                                 (        "HR","cut-people",  "LYP"),
                                 (       "BA" , "chase dev",  "ZYX")))
```

```
+------------+------------+---------+
| DEPARTMENT |  PROJECT   |  LEAD   |
+------------+------------+---------+
|  :String   |  :String   | :String |
+------------+------------+---------+
|    Dev     | manhattan  |   DGF   |
+------------+------------+---------+
|   Sales    | sell boom  |   ZJB   |
+------------+------------+---------+
|   Sales    | accounting |   JWH   |
+------------+------------+---------+
|     HR     |  recruit   |   LYP   |
+------------+------------+---------+
|     HR     | cut-people |   LYP   |
+------------+------------+---------+
|     BA     | chase dev  |   ZYX   |
+------------+------------+---------+
```

Now we do inner join on them:
```
scala> ppl.join(prj)
```

```
+------------+-------+---------+------+-------------------------------+------------+---------+
| DEPARTMENT |  ID   |  NAME   | AGE  |         ON_BOARD_DATE         |  PROJECT   |  LEAD   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|  :String   | :Long | :String | :Int |             :Date             |  :String   | :String |
+------------+-------+---------+------+-------------------------------+------------+---------+
|    Dev     |   1   |   DGF   |  33  | 2018-07-27T01:16:06.762+08:00 | manhattan  |   DGF   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|    Dev     |   2   |   YH    |  32  | 2018-07-27T01:16:06.800+08:00 | manhattan  |   DGF   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|   Sales    |   3   |   ZJB   |  38  | 2018-07-27T01:16:06.800+08:00 | sell boom  |   ZJB   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|   Sales    |   3   |   ZJB   |  38  | 2018-07-27T01:16:06.800+08:00 | accounting |   JWH   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|     BA     |   4   |   ZYX   |  33  | 2018-07-27T01:16:06.800+08:00 | chase dev  |   ZYX   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|     HR     |   5   |   LYP   |  33  | 2018-07-27T01:16:06.800+08:00 |  recruit   |   LYP   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|     HR     |   5   |   LYP   |  33  | 2018-07-27T01:16:06.800+08:00 | cut-people |   LYP   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|   Sales    |   6   |   JWH   |  33  | 2018-07-27T01:16:06.800+08:00 | sell boom  |   ZJB   |
+------------+-------+---------+------+-------------------------------+------------+---------+
|   Sales    |   6   |   JWH   |  33  | 2018-07-27T01:16:06.800+08:00 | accounting |   JWH   |
+------------+-------+---------+------+-------------------------------+------------+---------+
```
